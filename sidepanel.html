<!DOCTYPE html>
<html>
<head>
    <title>Trenddit Memo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .memo-list-item:hover {
            background-color: #f3f4f6;
        }
        .highlight-mode {
            cursor: crosshair !important;
        }
        .highlight-outline {
            outline: 2px solid #34D399 !important;
            outline-offset: 2px;
            transition: outline-color 0.2s ease;
        }
        .status-badge {
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }
        .status-badge.show {
            transform: translateY(0);
            opacity: 1;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .chat-message {
            opacity: 0;
            transform: translateY(10px);
            animation: message-fade-in 0.3s ease forwards;
        }

        @keyframes message-fade-in {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-tag-pill {
            transition: all 0.2s ease;
        }

        .chat-tag-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .typing-dots div {
            opacity: 0.6;
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #chatMessages::-webkit-scrollbar {
            width: 6px;
        }

        #chatMessages::-webkit-scrollbar-track {
            background: transparent;
        }

        #chatMessages::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }

        #chatMessages::-webkit-scrollbar-thumb:hover {
            background-color: rgba(156, 163, 175, 0.7);
        }

        #chatInput::-webkit-scrollbar {
            width: 6px;
        }

        #chatInput::-webkit-scrollbar-track {
            background: transparent;
        }

        #chatInput::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }

        #chatInput::-webkit-scrollbar-thumb:hover {
            background-color: rgba(156, 163, 175, 0.7);
        }

        /* Updated typing indicator styles */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background-color: #f3f4f6;
            border-radius: 12px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            background-color: #6b7280;
            border-radius: 50%;
            animation: typing-bounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .memo-citation {
            display: inline;
        }

        .toggle-switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }

        .toggle-switch input[type="checkbox"] {
            height: 0;
            width: 0;
            visibility: hidden;
            position: absolute;
        }

        .toggle-slider {
            width: 2.75rem;
            height: 1.5rem;
            background: #e5e7eb;
            display: block;
            border-radius: 100px;
            position: relative;
            transition: all 0.3s ease;
        }

        .toggle-slider:after {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            width: 1.25rem;
            height: 1.25rem;
            background: #fff;
            border-radius: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        input:checked + .toggle-slider {
            background: #3b82f6;
        }

        input:checked + .toggle-slider:after {
            left: calc(100% - 1.375rem);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        .sticky-toolbar {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto">
        <!-- Toolbar -->
        <div class="sticky-toolbar">
            <div class="flex items-center bg-white border-b border-gray-200">
                <div class="flex items-center space-x-2">
                    <button id="memosButton" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                        <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="tagsButton" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                        <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="chatButton" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                        <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div class="flex-1">
                    <!-- Title removed from toolbar -->
                </div>
                <div class="flex items-center">
                    <button id="memoButton" class="p-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors duration-200">
                        Capture
                    </button>
                    <div class="h-6 w-px bg-gray-300 mx-2"></div>
                    <button id="settingsButton" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors duration-200">
                        <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Provider indicator section -->
        <div class="px-4 py-2">
            <div class="text-right">
                <span id="providerIndicator" class="text-xs text-gray-500 flex items-center justify-end">
                    Using Claude
                    <svg id="visionIcon" class="w-3 h-3 ml-1 hidden" viewBox="0 0 20 20" fill="currentColor" title="Vision capable model">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                </span>
            </div>
        </div>

        <div class="p-4">
            <!-- Status Area -->
            <div id="statusArea" class="h-0 transition-all duration-300 ease-in-out overflow-hidden">
                <div id="statusBadge" class="transform translate-y-2 opacity-0 transition-all duration-300 ease-in-out bg-gray-50 border border-gray-200 rounded-lg p-3 flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div id="statusIcon" class="w-5 h-5"></div>
                    </div>
                    <div class="flex-grow min-w-0">
                        <p id="statusText" class="text-sm text-gray-600"></p>
                        <p id="statusSubtext" class="text-xs text-gray-500 mt-0.5 hidden"></p>
                    </div>
                </div>
            </div>

            <!-- Selection Guide -->
            <div id="selectionGuide" class="hidden transform translate-y-2 opacity-0 transition-all duration-300 ease-in-out bg-blue-50 border border-blue-100 rounded-lg p-3">
                <p class="text-sm text-blue-700">
                    <span class="font-medium">Selection Mode:</span> 
                    Click any content on the page to capture it. Press ESC or click Cancel to exit.
                </p>
            </div>

            <!-- Main Content Area -->
            <div id="memoListView" class="space-y-4">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-semibold text-gray-800">Memos</h2>
                </div>
                <!-- Memo items will be dynamically added here -->
            </div>

            <!-- Chat Panel -->
            <div id="chatPanel" class="hidden h-full flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-semibold text-gray-800">Chat with Memos</h2>
                </div>

                <!-- Tag Selection View -->
                <div id="chatTagSelection" class="space-y-4">
                    <div class="text-sm text-gray-600">Select a tag to chat with your Memos</div>
                    <div id="chatTagsList" class="flex flex-wrap gap-2">
                        <!-- Tags will be added here dynamically -->
                    </div>
                    
                    <!-- Saved Chats Section in Tag Selection -->
                    <div class="mt-6 pt-4 border-t">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Saved Chats</h3>
                        <div id="savedChatsList" class="space-y-2">
                            <!-- Saved chats will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div id="chatInterface" class="hidden flex flex-col h-full">
                    <div id="chatIntro" class="text-sm text-gray-600 mb-4"></div>
                    <!-- Source Toggle -->
                    <div class="flex flex-col space-y-2 mb-4">
                        <label class="toggle-switch">
                            <input type="checkbox" id="sourceToggle">
                            <span class="toggle-slider"></span>
                            <span class="ml-3 text-sm text-gray-600">Chat with Original Source</span>
                        </label>
                        <div id="tokenCount" class="text-xs text-gray-500 italic"></div>
                    </div>
                    <div id="chatMessages" class="flex-1 overflow-y-auto space-y-4 pb-4">
                        <!-- Messages will be added here dynamically -->
                    </div>
                    <div class="mt-4 pt-4">
                        <div id="chatTypingIndicator" class="hidden mb-2">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                        <div class="relative">
                            <textarea id="chatInput" 
                                      class="w-full border rounded-t-lg border-b-0 px-4 py-3 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                      style="min-height: 4.5rem;"
                                      placeholder="Prompt your Memos here. Press Enter / Return for response."></textarea>
                            <div class="chat-toolbar flex items-center px-3 py-2 bg-gray-50 border border-t-0 rounded-b-lg">
                                <button id="saveChatButton" class="hidden items-center space-x-1 text-xs text-gray-600 hover:text-blue-600 transition-colors duration-200">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                                    </svg>
                                    <span>Save</span>
                                </button>
                            </div>
                            <!-- Saved Chats Section -->
                            <div id="savedChatsSection" class="saved-chats mt-4 pt-4">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Memo Detail View -->
            <div id="memoDetailView" class="hidden space-y-4">
                <button id="backButton" class="text-blue-500 hover:text-blue-600 mb-4 flex items-center transition-colors duration-200">
                    <svg class="w-4 h-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Back to List
                </button>
                <div id="memoDetail" class="bg-white rounded-lg shadow p-6">
                    <h2 id="memoTitle" class="text-base font-bold mb-2"></h2>
                    <div class="flex items-center text-sm text-gray-500 mb-4">
                        <span id="memoTimestamp"></span>
                        <a id="memoSource" href="#" target="_blank" class="ml-4 flex items-center">
                            <img id="memoFavicon" class="w-4 h-4 mr-1" src="" alt="">
                            <span>Source</span>
                        </a>
                    </div>
                    <div id="memoSummary" class="text-sm text-gray-600 mb-4"></div>
                    <div class="bg-gray-50 p-3 rounded-lg mb-4 text-xs">
                        <div class="grid grid-cols-3 text-center">
                            <div class="border-r border-gray-200 px-2">
                                <div class="text-gray-500 uppercase tracking-wide">Source</div>
                                <div id="memoSourceSize" class="text-gray-800 font-medium mt-1"></div>
                            </div>
                            <div class="border-r border-gray-200 px-2">
                                <div class="text-gray-500 uppercase tracking-wide">Narrative</div>
                                <div id="memoNarrativeSize" class="text-gray-800 font-medium mt-1"></div>
                            </div>
                            <div class="px-2">
                                <div class="text-gray-500 uppercase tracking-wide">Data</div>
                                <div id="memoDataFields" class="text-gray-800 font-medium mt-1"></div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <h4 class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">Narrative</h4>
                            <div id="memoNarrative" class="prose text-sm text-gray-600"></div>
                        </div>
                        <div>
                            <h4 class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">Structured Data</h4>
                            <div id="memoJson" class="bg-gray-50 p-4 rounded-lg font-mono text-[0.5rem] leading-[0.9rem] text-gray-700 whitespace-pre-wrap overflow-x-auto"></div>
                        </div>
                    </div>
                    <div class="flex space-x-4 mt-6">
                        <button id="copyButton" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">
                            Copy
                        </button>
                        <button id="downloadButton" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">
                            Download
                        </button>
                        <button id="deleteButton" class="bg-red-100 hover:bg-red-200 text-red-800 px-4 py-2 rounded-lg">
                            Delete
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Panel -->
            <div id="settingsPanel" class="hidden p-4 space-y-4">
                <h2 class="text-lg font-semibold text-gray-800">AI Provider Settings</h2>
                
                <!-- Provider Selection -->
                <div class="space-y-2">
                    <label for="providerSelect" class="block text-sm font-medium text-gray-700">
                        AI Provider
                    </label>
                    <select id="providerSelect" 
                            class="block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
                        <option value="">Select an AI provider...</option>
                    </select>
                    <p class="text-xs text-gray-500">Choose your preferred AI provider for memo processing and chat</p>
                </div>

                <!-- Provider Configuration -->
                <div id="providerConfig" class="space-y-4">
                    <!-- Anthropic Configuration -->
                    <div id="anthropicConfig" class="hidden space-y-2">
                        <label for="anthropicKey" class="block text-sm font-medium text-gray-700">
                            Anthropic API Key
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="anthropicKey" 
                                   class="block w-full pr-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm" 
                                   placeholder="Enter your Anthropic API key">
                            <button class="toggle-visibility absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- OpenAI Configuration -->
                    <div id="openaiConfig" class="hidden space-y-2">
                        <label for="openaiKey" class="block text-sm font-medium text-gray-700">
                            OpenAI API Key
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="openaiKey" 
                                   class="block w-full pr-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm" 
                                   placeholder="sk-...">
                            <button class="toggle-visibility absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>


                    <!-- Gemini Configuration -->
                    <div id="geminiConfig" class="hidden space-y-2">
                        <label for="geminiKey" class="block text-sm font-medium text-gray-700">
                            Google AI API Key
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="geminiKey" 
                                   class="block w-full pr-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm" 
                                   placeholder="AIza...">
                            <button class="toggle-visibility absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Ollama Configuration -->
                    <div id="ollamaConfig" class="hidden space-y-3">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-center mb-2">
                                <svg class="w-5 h-5 text-blue-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                                <h4 class="text-sm font-medium text-blue-800">Ollama (Local LLM)</h4>
                            </div>
                            <p class="text-xs text-blue-700">Run AI models locally on your machine for privacy and offline use.</p>
                        </div>
                        
                        <div class="space-y-2">
                            <label for="ollamaHost" class="block text-sm font-medium text-gray-700">
                                Host
                            </label>
                            <input type="text" 
                                   id="ollamaHost" 
                                   class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm" 
                                   placeholder="localhost" 
                                   value="localhost">
                        </div>
                        
                        <div class="space-y-2">
                            <label for="ollamaPort" class="block text-sm font-medium text-gray-700">
                                Port
                            </label>
                            <input type="number" 
                                   id="ollamaPort" 
                                   class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm" 
                                   placeholder="11434" 
                                   value="11434"
                                   min="1" 
                                   max="65535">
                        </div>
                        
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <label for="ollamaModel" class="block text-sm font-medium text-gray-700">
                                    Model
                                </label>
                                <button id="refreshOllamaModels" 
                                        type="button" 
                                        class="text-xs text-blue-600 hover:text-blue-700 focus:outline-none">
                                    Refresh Models
                                </button>
                            </div>
                            <select id="ollamaModel" 
                                    class="block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <option value="">Select model...</option>
                            </select>
                        </div>
                        
                        <div class="ollama-status">
                            <div id="ollamaServiceStatus" class="flex items-center text-xs">
                                <div class="w-2 h-2 rounded-full mr-2" id="ollamaStatusDot"></div>
                                <span id="ollamaStatusText">Checking service...</span>
                            </div>
                        </div>
                        
                        <div class="ollama-help">
                            <details class="text-xs">
                                <summary class="cursor-pointer text-blue-600 hover:text-blue-700 select-none">
                                    Need help setting up Ollama?
                                </summary>
                                <div class="mt-2 p-3 bg-gray-50 rounded text-gray-700 space-y-1">
                                    <p>1. Install Ollama from <a href="https://ollama.ai" target="_blank" class="text-blue-600 hover:underline">https://ollama.ai</a></p>
                                    <p>2. Start the Ollama service</p>
                                    <p>3. Download a model: <code class="bg-gray-200 px-1 rounded">ollama pull llama2</code></p>
                                    <p>4. Refresh models in this settings panel</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- Model Selection -->
                    <div id="modelSelection" class="hidden space-y-2">
                        <label for="modelSelect" class="block text-sm font-medium text-gray-700">
                            Model
                        </label>
                        <select id="modelSelect" 
                                class="block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </select>
                        <p class="text-xs text-gray-500">Choose the specific model for your selected provider</p>
                    </div>
                </div>

                <!-- Save Button -->
                <button id="saveSettings" 
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Save Settings
                </button>

                <!-- Test Connection Button -->
                <button id="testConnection" 
                        class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Test Connection
                </button>
            </div>

            <!-- Tags Panel -->
            <div id="tagsPanel" class="hidden space-y-4">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-semibold text-gray-800">Tags</h2>
                    <button id="addTagButton" class="text-blue-500 hover:text-blue-600 text-sm flex items-center">
                        <svg class="w-4 h-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        Add Tag
                    </button>
                </div>

                <!-- Add Tag Form -->
                <div id="addTagForm" class="hidden bg-gray-50 p-4 rounded-lg space-y-3 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tag Name</label>
                        <input type="text" id="newTagName" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="newTagDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button id="cancelAddTag" class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800">Cancel</button>
                        <button id="saveNewTag" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">Save Tag</button>
                    </div>
                </div>

                <!-- Tags List -->
                <div id="tagsList" class="space-y-3">
                    <!-- Shopping -->
                    <div class="group flex items-start space-x-3 p-3 bg-pink-50 rounded-lg cursor-pointer hover:bg-pink-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-pink-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-pink-900">Shopping</span>
                                    <span class="tag-count text-sm text-pink-600">0</span>
                                </div>
                                <button class="text-pink-400 hover:text-pink-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-pink-700 mt-1">Shopping discovery, research, trends, deals, comparisons, reviews, and recommendations.</p>
                        </div>
                    </div>

                    <!-- Travel -->
                    <div class="group flex items-start space-x-3 p-3 bg-blue-50 rounded-lg cursor-pointer hover:bg-blue-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-blue-900">Travel</span>
                                    <span class="tag-count text-sm text-blue-600">0</span>
                                </div>
                                <button class="text-blue-400 hover:text-blue-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-blue-700 mt-1">Travel planning, research, deals, and recommendations.</p>
                        </div>
                    </div>

                    <!-- Health -->
                    <div class="group flex items-start space-x-3 p-3 bg-green-50 rounded-lg cursor-pointer hover:bg-green-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-green-900">Health</span>
                                    <span class="tag-count text-sm text-green-600">0</span>
                                </div>
                                <button class="text-green-400 hover:text-green-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-green-700 mt-1">Health research, tips, and advice.</p>
                        </div>
                    </div>

                    <!-- Technology -->
                    <div class="group flex items-start space-x-3 p-3 bg-purple-50 rounded-lg cursor-pointer hover:bg-purple-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-purple-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-purple-900">Technology</span>
                                    <span class="tag-count text-sm text-purple-600">0</span>
                                </div>
                                <button class="text-purple-400 hover:text-purple-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-purple-700 mt-1">Technology research, tips, advice, learning, products, companies, and trends.</p>
                        </div>
                    </div>

                    <!-- Investing -->
                    <div class="group flex items-start space-x-3 p-3 bg-yellow-50 rounded-lg cursor-pointer hover:bg-yellow-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-yellow-900">Investing</span>
                                    <span class="tag-count text-sm text-yellow-600">0</span>
                                </div>
                                <button class="text-yellow-400 hover:text-yellow-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-yellow-700 mt-1">Investing research, tips, and advice.</p>
                        </div>
                    </div>

                    <!-- Entertainment -->
                    <div class="group flex items-start space-x-3 p-3 bg-red-50 rounded-lg cursor-pointer hover:bg-red-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.92 3.845a19.361 19.361 0 01-6.85 1.335c-2.354.068-4.73-.108-7.07-.577v11.543c2.34.47 4.716.645 7.07.577 2.354-.068 4.73-.344 7.07-.577V3.845z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-red-900">Entertainment</span>
                                    <span class="tag-count text-sm text-red-600">0</span>
                                </div>
                                <button class="text-red-400 hover:text-red-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-red-700 mt-1">Restaurants, movies, music, books, and events.</p>
                        </div>
                    </div>

                    <!-- Education -->
                    <div class="group flex items-start space-x-3 p-3 bg-indigo-50 rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors duration-200">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-indigo-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium text-indigo-900">Education</span>
                                    <span class="tag-count text-sm text-indigo-600">0</span>
                                </div>
                                <button class="text-indigo-400 hover:text-indigo-600 delete-tag">
                                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-indigo-700 mt-1">Learning, courses, and resources.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script type="module" src="sidepanel.js"></script>
</body>
</html> 